<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Ekasilicon Audit Methodology</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="style.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{â€¦}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
</script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Ekasilicon Audit Methodology</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Worked_.Example%29" class="tocviewlink" data-pltdoc="x">Worked Example</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Discussion%29" class="tocviewlink" data-pltdoc="x">Discussion</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Ekasilicon_.Audit_.Methodology%29" class="tocsubseclink" data-pltdoc="x">Ekasilicon Audit Methodology</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Worked_.Example%29" class="tocsubseclink" data-pltdoc="x">Worked Example</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.The_.Program%29" class="tocsubseclink" data-pltdoc="x">The Program</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.The_.Properties%29" class="tocsubseclink" data-pltdoc="x">The Properties</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.The_.Model%29" class="tocsubseclink" data-pltdoc="x">The Model</a></td></tr><tr><td><span class="tocsublinknumber">1.4<tt>&nbsp;</tt></span><a href="#%28part._.The_.Transition_.Schemas%29" class="tocsubseclink" data-pltdoc="x">The Transition Schemas</a></td></tr><tr><td><span class="tocsublinknumber">1.5<tt>&nbsp;</tt></span><a href="#%28part._.Proving_the_.Properties%29" class="tocsubseclink" data-pltdoc="x">Proving the Properties</a></td></tr><tr><td><span class="tocsublinknumber">1.5.1<tt>&nbsp;</tt></span><a href="#%28part._.The_amount_deposited_is_credited_to_the_account_and_the_global_total%29" class="tocsubseclink" data-pltdoc="x">The amount deposited is credited to the account and the global total</a></td></tr><tr><td><span class="tocsublinknumber">1.5.2<tt>&nbsp;</tt></span><a href="#%28part._.The_amount_withdrawn_is_debited_from_the_account_and_the_global_total%29" class="tocsubseclink" data-pltdoc="x">The amount withdrawn is debited from the account and the global total</a></td></tr><tr><td><span class="tocsublinknumber">1.5.3<tt>&nbsp;</tt></span><a href="#%28part._.The_amount_withdrawn_does_not_exceed_the_net_deposit_amount%29" class="tocsubseclink" data-pltdoc="x">The amount withdrawn does not exceed the net deposit amount</a></td></tr><tr><td><span class="tocsublinknumber">1.5.4<tt>&nbsp;</tt></span><a href="#%28part._.Once_the_bank_is_deployed__the_global_total_is_always_the_sum_of_the_account_totals%29" class="tocsubseclink" data-pltdoc="x">Once the bank is deployed, the global total is always the sum of the account totals</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Discussion%29" class="tocsubseclink" data-pltdoc="x">Discussion</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.2</span></div><h2><a name="(part._.Ekasilicon_.Audit_.Methodology)"></a>Ekasilicon Audit Methodology</h2><p>The Ekasilication auditing approach begins with the identification of desired properties that the program should exhibit.
These identified properties, combined with your program&rsquo;s implementation, guide the development of a custom model specific to your program and amenable to proving the properties.
This model captures the high-level logical roles of the quantities and constraints your program uses.
We specialize a TEAL static analyzer with this custom model to obtain program-specific results.
The range of customization available to models is fairly large and can typically accommodate the present implementation of the program (assuming the desired properties actually hold).</p><p><div class="SIntrapara">The analyzer first produces a set of transition schemas which, due to the custom model, are in terms of the high-level program logic.
These transitions induce a state graph which represents the evolution your dApp can undergo.
From this state graph, we direct the analyzer in applying techniques, like model checking, to ensure that certain properties hold.
Broadly speaking, these properties are either:
</div><div class="SIntrapara"><ol><li><p><span class="emph">safety</span> properties, which express that some destination state Y is not reachable from point X or that some transition is not feasible from point X;</p></li><li><p><span class="emph">liveness</span> properties, which express that some destination state Y is invariably reachable from point X or that some transition is always feasible from point X; or</p></li><li><p><span class="emph">invariance</span> properties, which express that something at a particular state is true regardless of the path taken to arrive at it.</p></li></ol></div></p><p>Whatever the custom model, the analyzer also detects the violation of generic safety properties, such as an inadequately-constrained &lsquo;OnCompletion&lsquo; parameter.</p><h3>1<tt>&nbsp;</tt><a name="(part._.Worked_.Example)"></a>Worked Example</h3><p>To illustrate this process, we will walk through the process on a simple program.</p><h4>1.1<tt>&nbsp;</tt><a name="(part._.The_.Program)"></a>The Program</h4><p>The following program implements a simple bank which tracks both individual account balances and the total account balance.</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#pragma version 6</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">txn ApplicationID</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">bz deploy</span></p></td></tr><tr><td><p><span class="stt">main:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">txn OnCompletion</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">dup</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int OptIn</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">bz action</span></p></td></tr><tr><td><p><span class="stt">create:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">pop</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_local_put</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">b exit</span></p></td></tr><tr><td><p><span class="stt">action:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int NoOp</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">assert</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">txna ApplicationArgs 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">btoi</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">dup</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">bz withdraw</span></p></td></tr><tr><td><p><span class="stt">deposit:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">==</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">assert</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">txna ApplicationArgs 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">btoi</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">dup</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_local_get</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">+</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_local_put</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_global_get</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">+</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_global_put</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">b exit</span></p></td></tr><tr><td><p><span class="stt">withdraw:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">pop</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">txna ApplicationArgs 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">btoi</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_local_get</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">dig 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">- // if succeeds, then balance was high enough</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 2</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_local_put</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_global_get</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">-</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">uncover 1</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_global_put</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">b exit</span></p></td></tr><tr><td><p><span class="stt">deploy:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">byte ""</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 0</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">app_global_put</span></p></td></tr><tr><td><p><span class="stt">exit:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">int 1</span></p></td></tr></table></p><p><div class="SIntrapara">The intended functionality of the program is that:
</div><div class="SIntrapara"><ul><li><p>The bank is initialized with a global balance of 0 and no accounts.</p></li><li><p>A client opens an empty account (tied to their address) at the bank by opting in.</p></li><li><p>A client can deposit funds into their account.</p></li><li><p>A client can withdraw funds from their account.</p></li></ul></div></p><p>As a simple example, no assets are actually transferred, so the client provides the deposit amount as an argument.
Accordingly, this example exhibits no issues related to minimum account balances or fees, which would manifest in real-world dApps.
Nevertheless, there are not-entirely-trivial properties that we may wish to show for this program which have analogues in real-world programs.</p><p><div class="SIntrapara">Even this simple program exhibits traits of the high-level model it implements:
</div><div class="SIntrapara"><ul><li><p>Logical blocks are labelled with informative names and regardless of whether they are jump targets.</p></li><li><p>It contains a comment which is suggestive of a desired property.</p></li></ul></div><div class="SIntrapara">None of this high-level signage is treated by the assembler at all, however.
The next steps produce a correspondence between the assembled program and the high-level intent discarded by the assembler (and compiler, if the source program is not TEAL).</div></p><h4>1.2<tt>&nbsp;</tt><a name="(part._.The_.Properties)"></a>The Properties</h4><p><div class="SIntrapara">There are a number of different properties we would like this bank to have, which vary both in strength and difficulty to establish.
These include that:
</div><div class="SIntrapara"><ul><li><p>the amount deposited is credited to the account and the global total;</p></li><li><p>the amount withdrawn is debited from the account and the global total;</p></li><li><p>the amount withdrawn does not exceed the net deposit amount; and</p></li><li><p>once the bank is deployed, the global total is always the sum of the account totals.</p></li></ul></div><div class="SIntrapara">This list is not exhaustive;
in particular, each of these properties can be weakened (e.g. by weakening equalities to inequalities).</div></p><h4>1.3<tt>&nbsp;</tt><a name="(part._.The_.Model)"></a>The Model</h4><p>A model conveys how machine actions should be interpreted in terms of the high-level program logic.
For this program, these terms are whether the bank exists, whether a given account exists, the balance of a particular account, and the action that a client takes.</p><p><div class="SIntrapara">The machine-model mapping is as follows:
</div><div class="SIntrapara"><ul><li><p><span class="texMathInline">\mathrm{ApplicationID} = 0</span> corresponds to the <span class="texMathInline">\mathrm{DeployBank}</span> action.</p></li><li><p>If the bank exists, <span class="texMathInline">\mathrm{OnCompletion} = 1</span> corresponds to the <span class="texMathInline">\mathrm{CreateAccount}</span> action.</p></li><li><p>If the bank exists and the client has an account, <span class="texMathInline">\mathrm{OnCompletion} = 0</span> and <span class="texMathInline">\mathrm{btoi}(\mathrm{ApplicationArgs}[0]) = 0</span> correspond to the <span class="texMathInline">\mathrm{Withdraw}</span> action, and <span class="texMathInline">\mathrm{btoi}(\mathrm{ApplicationArgs}[1])</span> represents the amount to withdraw.</p></li><li><p>If the bank exists and the client has an account, <span class="texMathInline">\mathrm{OnCompletion} = 0</span> and <span class="texMathInline">\mathrm{btoi}(\mathrm{ApplicationArgs}[0]) = 1</span> correspond to the <span class="texMathInline">\mathrm{Deposit}</span> action, and <span class="texMathInline">\mathrm{btoi}(\mathrm{ApplicationArgs}[1])</span> represents the amount to deposit.</p></li><li><p>If the bank exists, <span class="texMathInline">\mathrm{Global}[{}&rsquo;{}&rsquo;]</span> corresponds to <span class="texMathInline">\mathrm{GlobalBalance}</span>.</p></li><li><p>If an account for <span class="texMathInline">\mathit{addr}</span> exists, <span class="texMathInline">\mathrm{Local}[\mathit{addr},{}&rsquo;{}&rsquo;]</span> corresponds to <span class="texMathInline">\mathrm{LocalBalance}[\mathit{addr}]</span>.</p></li></ul></div></p><h4>1.4<tt>&nbsp;</tt><a name="(part._.The_.Transition_.Schemas)"></a>The Transition Schemas</h4><p><div class="SIntrapara">Under this model, the analyzer determines that the following four transition schemas (and no others) are valid:
</div><div class="SIntrapara"><ol><li><ul><li><p><span class="texMathInline">\mathit{action} = \mathrm{DeployBank}</span></p></li><li><p><span class="texMathInline">\vdash \mathrm{BankExists}</span></p></li><li><p><span class="texMathInline">\mathrm{GlobalBalance} := 0</span></p></li></ul></li><li><ul><li><p><span class="texMathInline">\mathrm{BankExists}</span></p></li><li><p><span class="texMathInline">\mathit{action} = \mathrm{CreateAccount}</span></p></li><li><p><span class="texMathInline">\neg \mathrm{AccountExists}[\mathrm{Sender}]</span></p></li><li><p><span class="texMathInline">\vdash \mathrm{AccountExists}[\mathrm{Sender}]</span></p></li><li><p><span class="texMathInline">\mathrm{LocalBalance}[\mathrm{Sender}] := 0</span></p></li></ul></li><li><ul><li><p><span class="texMathInline">\mathrm{BankExists}</span></p></li><li><p><span class="texMathInline">\mathit{action} = \mathrm{Withdraw}</span></p></li><li><p><span class="texMathInline">\mathrm{AccountExists}[\mathrm{Sender}]</span></p></li><li><p><span class="texMathInline">\mathrm{GlobalBalance} \ge \mathrm{Amount}</span></p></li><li><p><span class="texMathInline">\mathrm{LocalBalance}[\mathrm{Sender}] \ge \mathrm{Amount}</span></p></li><li><p><span class="texMathInline">\mathrm{GlobalBalance} := \mathrm{GlobalBalance} - \mathrm{Amount}</span></p></li><li><p><span class="texMathInline">\mathrm{LocalBalance}[\mathrm{Sender}] := \mathrm{LocalBalance}[\mathrm{Sender}] - \mathrm{Amount}</span></p></li></ul></li><li><ul><li><p><span class="texMathInline">\mathrm{BankExists}</span></p></li><li><p><span class="texMathInline">\mathit{action} = \mathrm{Deposit}</span></p></li><li><p><span class="texMathInline">\mathrm{AccountExists}[\mathrm{Sender}]</span></p></li><li><p><span class="texMathInline">\mathrm{GlobalBalance} + \mathrm{Amount} &lt; 2^{64}</span></p></li><li><p><span class="texMathInline">\mathrm{LocalBalance}[\mathrm{Sender}] + \mathrm{Amount} &lt; 2^{64}</span></p></li><li><p><span class="texMathInline">\mathrm{GlobalBalance} := \mathrm{GlobalBalance} + \mathrm{Amount}</span></p></li><li><p><span class="texMathInline">\mathrm{LocalBalance}[\mathrm{Sender}] := \mathrm{LocalBalance}[\mathrm{Sender}] + \mathrm{Amount}</span></p></li></ul></li></ol></div><div class="SIntrapara">These transition schemas induce the graph</div></p><p><img src="state-diagram.svg" alt="" width="214.419913pt" height="103.910827pt" class="state-diagram"/></p><p>which reflects that this program implements a dApp which does not "progress" through a protocol in any meaningful sense.</p><h4>1.5<tt>&nbsp;</tt><a name="(part._.Proving_the_.Properties)"></a>Proving the Properties</h4><p>We can now look at how each previously-given property can be proved from this account of the program.</p><h5>1.5.1<tt>&nbsp;</tt><a name="(part._.The_amount_deposited_is_credited_to_the_account_and_the_global_total)"></a>The amount deposited is credited to the account and the global total</h5><p>This is local to the <span class="texMathInline">\mathrm{Deposit}</span> transition.</p><h5>1.5.2<tt>&nbsp;</tt><a name="(part._.The_amount_withdrawn_is_debited_from_the_account_and_the_global_total)"></a>The amount withdrawn is debited from the account and the global total</h5><p>This is local to the <span class="texMathInline">\mathrm{Withdraw}</span> transition.</p><h5>1.5.3<tt>&nbsp;</tt><a name="(part._.The_amount_withdrawn_does_not_exceed_the_net_deposit_amount)"></a>The amount withdrawn does not exceed the net deposit amount</h5><p>This property is local to the <span class="texMathInline">\mathrm{Withdraw}</span> once it is established that the account balance reflects the net effect of all previous deposits and withdrawls to the account.</p><p>For this, we prove that the account balance is invariant under any transaction whose <span class="texMathInline">\mathrm{Sender}</span> differs from the account owner.
This is a simple case analysis on transitions.
We then use induction on the sequence of transitions, considering whether the <span class="texMathInline">\mathrm{Sender}</span> is the owner of the account under interest at each step.
This establishes that the current account balance reflects the net effect of previous transitions, and then the local check can be applied to obtain the result.</p><h5>1.5.4<tt>&nbsp;</tt><a name="(part._.Once_the_bank_is_deployed__the_global_total_is_always_the_sum_of_the_account_totals)"></a>Once the bank is deployed, the global total is always the sum of the account totals</h5><p>Expressed mathematically, this variant is
<span class="texMathDisplay">\mathrm{GlobalBalance} = \sum_{\mathit{addr} \in \mathrm{Account}} \mathrm{LocalBalance}[\mathit{addr}]</span>
and proved by induction.</p><p>The base case is that transaction schema 1, which effects the <span class="texMathInline">\mathrm{DeployBank}</span> action, initializes the global balance to 0 and the deployment begins with an empty <span class="texMathInline">\mathrm{Account}</span> set.</p><p><span class="texMathDisplay">0 = \sum_{\mathit{addr} \in \emptyset} \mathrm{LocalBalance}[\mathit{addr}]</span></p><p>The inductive step considers transaction schemas 1, 2, and 3 which effect the remaining actions.</p><p>Before the transition, we assume that
<span class="texMathDisplay">\mathrm{GlobalBalance}_\mathit{in} = \sum_{\mathit{addr} \in \mathrm{Account}_\mathit{in}} \mathrm{LocalBalance}_\mathit{in}[\mathit{addr}]</span>
holds.
For each transition, we set out to show that
<span class="texMathDisplay">\mathrm{GlobalBalance}_\mathit{out} = \sum_{\mathit{addr} \in \mathrm{Account}_\mathit{out}} \mathrm{LocalBalance}_\mathit{out}[\mathit{addr}]</span>
where the definitions of
<span class="texMathInline">\mathrm{GlobalBalance}_\mathit{out}</span>,
<span class="texMathInline">\mathrm{Account}_\mathit{out}</span>,
and
<span class="texMathInline">\mathrm{LocalBalance}_\mathit{out}</span>
are specific to the transaction schema.</p><p>The <span class="texMathInline">\mathrm{CreateAccount}</span>-actioned schema succeeds only when a <span class="texMathInline">\mathrm{Sender}</span> account doesn&rsquo;t already exist, so we have
<span class="texMathInline">\mathrm{GlobalBalance}_\mathit{out} = \mathrm{GlobalBalance}_\mathit{in}</span>,
<span class="texMathInline">\mathrm{Account}_\mathit{out} = \mathrm{Account}_\mathit{in} \cup \{ \mathrm{Sender} \}</span>, and
<span class="texMathInline">\mathrm{LocalBalance}_\mathit{out} = \mathrm{LocalBalance}_\mathit{in}[ \mathrm{Sender} \mapsto 0 ]</span>.</p><p>For the <span class="texMathInline">\mathrm{Withdraw}</span>-actioned schema, we have
<span class="texMathInline">\mathrm{GlobalBalance}_\mathit{out} = \mathrm{GlobalBalance}_\mathit{in} - \mathrm{Amount}</span>,
<span class="texMathInline">\mathrm{Account}_\mathit{out} = \mathrm{Account}_\mathit{in}</span>, and
<span class="texMathInline">\mathrm{LocalBalance}_\mathit{out} = \mathrm{LocalBalance}_\mathit{in}[ \mathrm{Sender} \mapsto X - \mathrm{Amount} ]</span> where <span class="texMathInline">X = \mathrm{LocalBalance}_\mathit{in}[\mathrm{Sender}]</span>.</p><p>For the <span class="texMathInline">\mathrm{Deposit}</span>-actioned schema, we have
<span class="texMathInline">\mathrm{GlobalBalance}_\mathit{out} = \mathrm{GlobalBalance}_\mathit{in} + \mathrm{Amount}</span>,
<span class="texMathInline">\mathrm{Account}_\mathit{out} = \mathrm{Account}_\mathit{in}</span>, and
<span class="texMathInline">\mathrm{LocalBalance}_\mathit{out} = \mathrm{LocalBalance}_\mathit{in}[ \mathrm{Sender} \mapsto X + \mathrm{Amount} ]</span> where <span class="texMathInline">X = \mathrm{LocalBalance}_\mathit{in}[\mathrm{Sender}]</span>.</p><p>In each of these cases, the desired postcondition follows easily from the precondition.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Discussion)"></a>Discussion</h3><p>The early step to extend the analyzer with a custom model is significant and may raise a question:
why not just prove properties about the model directly?
While there is some value in proving that the model that drove the implementation has desired properties, this alone does not demonstrate that the implementation itself exhibits those properties.
Reconstructing the model from the program makes certain machine specifics explicit (such as overflow) and thereby provides an end-to-end guarantee about the dApp behavior, from high-level property to deployed bytecode.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>